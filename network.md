## 网络层服务
在发送主机和接收主机之间传送段   
基本流程：  
路由->控制平面->算出路由表  
ip协议（在数据平面进行操作）对路由表进行匹配，进行转发   

### OSPF
在as里面泛洪，不会往外溢出，控制泛洪范围（原理是LS算法在区域内的分发，路由计算使用Dijkstra算法）
### BGP
eBGP：从相邻ases中获得子网可达信息    
iBGP：将获得的子网可达信息传遍到as内部的所有路由器中

### ICMP
ping 命令： 使用的是 ICMP回显请求 和 ICMP回显应答 消息。

你ping www.google.com时， 你的电脑会发送一个 ICMP Echo Request 到目标。

如果目标可达且允许响应，它会返回一个 ICMP Echo Reply。

通过计算往返时间，你可以判断网络的连通性和延迟。

traceroute / tracert 命令： 巧妙地利用ICMP的 超时 和 目的地不可达 消息来追踪数据包到达目标所经过的路径。

它发送一系列TTL值递增的数据包。

路径上的每个路由器在TTL减至0时，都会发回一个ICMP超时消息，从而暴露自己的地址。

最终到达目标时，目标会返回一个“端口不可达”消息（通常是UDP探测）或“回显应答”（ICMP探测），完成路径追踪。
### 功能
#### 数据平面（局部）
转发：将分组从路由器的输入端口转发到合适的输出端口   
> 传统的转发：基于目标地址+路由表
> SDN方式：基于多个字段+流表

#### 控制平面（全局）
路由：使用路由算法来决定分组从发送主机到目标主机的路径
通过路由选择算法与路径

### 子网   
无需经过中间路由器即可物理到达的目标端口

#### 分类方法
#### CIDR  
无类的ip划分
CIDR 用于将多个连续IP地址块聚合，减少路由表条目。

示例：
将 192.168.0.0/22 划分为4个子网。

原网络：192.168.0.0/22（主机位10位，共1022个可用地址）

需要4个子网，需借用2位（2²=4），新前缀长度为 22+2=24

子网地址：

192.168.0.0/24

192.168.1.0/24

192.168.2.0/24

192.168.3.0/24

每个子网可用主机地址范围（排除网络地址和广播地址）：

192.168.0.1 ~ 192.168.0.254

192.168.1.1 ~ 192.168.1.254

192.168.2.1 ~ 192.168.2.254

192.168.3.1 ~ 192.168.3.254
#### NAT
识别NAT类型：

R2上的规则是DNAT（目的地址转换），将外部对公网IP的访问转发到内部Web服务器。

R3上的规则是SNAT（源地址转换），将内部私有地址转换为公网地址。

分析数据包地址变化：

H2发送时：源IP（H2私有地址），目的IP（Web服务器的公网地址或R2的公网地址）。

经过R3（SNAT）：源IP变为R3的公网地址。

经过R2（DNAT）：目的IP变为Web服务器的私有地址。

NAT表配置：

R2需要配置一条DNAT规则：将到达特定公网IP和端口（如80）的请求转发到内部Web服务器。
###### DHCP
> Discover	客户端 → 网络（广播）	客户端大喊：“我是新来的，有DHCP服务器吗？我需要一个IP地址！”   
> Offer	服务器 → 客户端（广播/单播）	DHCP服务器响应：“有！我给你提供一个可用的IP地址（比如192.168.1.100），租给你用一段时间。” （注意：可能有多个服务器响应）    
> Request	客户端 → 网络（广播）	客户端选择一个Offer（通常是第一个收到的），并广播宣布：“我接受这个服务器的Offer，我要用这个IP地址！” 这个广播是为了通知其他服务器收回它们提供的地址。      
> Acknowledgement	服务器 → 客户端（广播/单播）	被选中的服务器最后确认：“成交！这个IP地址正式分配给你了，这是租约和所有配置信息。”
